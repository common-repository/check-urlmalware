<?php
/*
Plugin Name: Check-urlmalware
Plugin URI: http://www.renardudezert.com/2010/12/21/plugin-wordpress-check-urlmalware.html
Description: Check if the comment author url contain a malware using <a href="http://www.unmaskparasites.com/">unmaskparasites</a>.
Version: 1.0
Author: Renardudezert
Author URI:  http://www.renardudezert.com
*/

#           DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE
#                   Version 2, December 2004
#
# Copyright (C) 2004 Sam Hocevar
# 14 rue de Plaisance, 75014 Paris, France
# Everyone is permitted to copy and distribute verbatim or modified
# copies of this license document, and changing it is allowed as long
# as the name is changed.
#
#           DO WHAT THE FUCK YOU WANT TO PUBLIC LICENSE
#  TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION
#
# 0. You just DO WHAT THE FUCK YOU WANT TO.

function wp_cm_head()
{
  $css_url = get_bloginfo("wpurl") . "/wp-content/plugins/check-urlmalware/css/jquery.fancybox-1.3.4.css";
  $js_url = get_bloginfo("wpurl") . "/wp-content/plugins/check-urlmalware/js/jquery.fancybox-1.3.4.pack.js";
  if (file_exists(TEMPLATEPATH . "/jquery.fancybox-1.3.4.css"))
  {
    $css_url = get_bloginfo("template_url") . "/jquery.fancybox-1.3.4.css";
  }
   if (file_exists(TEMPLATEPATH . "/jquery.fancybox-1.3.4.pack.js"))
  {
    $js_url = get_bloginfo("template_url") . "/jquery.fancybox-1.3.4.pack.js";
  }

  echo "\n".'<link rel="stylesheet" href="' . $css_url . '" type="text/css" media="screen" />'."\n";
  echo"\n".' <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"></script>'."\n";
  echo "\n".'<script type="text/javascript" src="' . $js_url . '"></script>'."\n";
  echo "\n".'<script type="text/javascript">'."\n";
  echo  <<<EOF
  jQuery(document).ready(function() {
    $(".check-malware").fancybox({
		'width'				: '75%',
		'height'			: '75%',
        'autoScale'     	: false,
        'transitionIn'		: 'none',
		'transitionOut'		: 'none',
		'type'				: 'iframe'
	});
    });
EOF;
  echo "\n".'</script>'."\n";

}


function check_malware($actions, $comment)
{
	if (!empty($comment->comment_author_url))
	{
	$actions['check_malware'] = '<a href="http://www.unmaskparasites.com/security-report/?page='.esc_attr($comment->comment_author_url).'" class="check-malware">'.__( 'Check Malware', 'check-urlmalware' ).'</a>';
	}
	return $actions;
}

// Put css and js in the admin head
add_action('admin_head', 'wp_cm_head');

add_filter('comment_row_actions', 'check_malware',10,2);
?>
